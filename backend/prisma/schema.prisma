generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String   @id @default(uuid())
  email         String   @unique
  password      String
  role          UserRole @default(STORE_OWNER)
  iban          String?
  emailVerified Boolean  @default(false)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  ownedTenants  Tenant[]
  payments      Payment[]
  verificationCodes VerificationCode[]

  @@map("users")
}

model Tenant {
  id            String         @id @default(uuid())
  name          String
  subdomain     String         @unique
  customDomain  String?        @unique
  description   String?
  ownerId       String
  isActive      Boolean        @default(true)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  carts         Cart[]
  categories    Category[]
  orders        Order[]
  productImages ProductImage[]
  products      Product[]
  settings      StoreSettings?
  payments      Payment[]
  subscription  Subscription?
  owner         User           @relation(fields: [ownerId], references: [id])

  @@map("tenants")
}

model Category {
  id          String     @id @default(uuid())
  name        String
  slug        String
  description String?
  parentId    String?
  tenantId    String
  isActive    Boolean    @default(true)
  isDeleted   Boolean    @default(false)
  deletedAt   DateTime?
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  parent      Category?  @relation("CategoryHierarchy", fields: [parentId], references: [id])
  children    Category[] @relation("CategoryHierarchy")
  tenant      Tenant     @relation(fields: [tenantId], references: [id])
  products    Product[]

  @@index([tenantId, isDeleted])
  @@index([slug, tenantId])
  @@map("categories")
}

model Product {
  id            String           @id @default(uuid())
  title         String
  description   String?
  slug          String
  sku           String?
  price         Float
  stockQuantity Int              @default(0)
  isActive      Boolean          @default(true)
  isDeleted     Boolean          @default(false)
  deletedAt     DateTime?
  tenantId      String
  categoryId    String?
  attributes    Json?
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  cartItems     CartItem[]
  orderItems    OrderItem[]
  images        ProductImage[]
  variants      ProductVariant[]
  category      Category?        @relation(fields: [categoryId], references: [id])
  tenant        Tenant           @relation(fields: [tenantId], references: [id])

  @@unique([sku, tenantId])
  @@index([tenantId, isDeleted])
  @@index([tenantId, isActive])
  @@index([slug, tenantId])
  @@map("products")
}

model ProductImage {
  id        String   @id @default(uuid())
  url       String
  altText   String?
  filename  String
  productId String
  tenantId  String
  sortOrder Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  tenant    Tenant   @relation(fields: [tenantId], references: [id])

  @@map("product_images")
}

model ProductVariant {
  id            String      @id @default(uuid())
  productId     String
  sku           String?     @unique
  options       Json
  price         Float?
  stockQuantity Int         @default(0)
  isActive      Boolean     @default(true)
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  product       Product     @relation(fields: [productId], references: [id], onDelete: Cascade)
  cartItems     CartItem[]
  orderItems    OrderItem[]

  @@map("product_variants")
}

model Cart {
  id            String     @id @default(uuid())
  sessionId     String     @unique
  tenantId      String
  customerEmail String?
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  items         CartItem[]
  tenant        Tenant     @relation(fields: [tenantId], references: [id])

  @@map("carts")
}

model CartItem {
  id        String          @id @default(uuid())
  cartId    String
  productId String
  variantId String?
  quantity  Int             @default(1)
  price     Float
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
  cart      Cart            @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product   Product         @relation(fields: [productId], references: [id])
  variant   ProductVariant? @relation(fields: [variantId], references: [id])

  @@unique([cartId, productId, variantId])
  @@map("cart_items")
}

model Order {
  id              String        @id @default(uuid())
  orderNumber     String        @unique
  tenantId        String
  customerEmail   String
  customerName    String
  status          OrderStatus   @default(PENDING)
  totalAmount     Float
  paymentStatus   PaymentStatus @default(PENDING)
  bogOrderId      String?       @unique
  shippingAddress Json?
  billingAddress  Json?
  notes           String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  items           OrderItem[]
  tenant          Tenant        @relation(fields: [tenantId], references: [id])

  @@map("orders")
}

model OrderItem {
  id          String          @id @default(uuid())
  orderId     String
  productId   String
  variantId   String?
  quantity    Int
  price       Float
  title       String
  variantData Json?
  createdAt   DateTime        @default(now())
  order       Order           @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product     Product         @relation(fields: [productId], references: [id])
  variant     ProductVariant? @relation(fields: [variantId], references: [id])

  @@map("order_items")
}

model StoreSettings {
  id             String   @id @default(uuid())
  tenantId       String   @unique
  aboutUs        Json?
  contact        Json?
  privacyPolicy  Json?
  termsOfService Json?
  shippingInfo   Json?
  returns        Json?
  faq            Json?
  facebookUrl    String?
  twitterUrl     String?
  instagramUrl   String?
  linkedinUrl    String?
  youtubeUrl     String?
  trackOrderUrl  String?
  backgroundColor String? @default("#fafafa")
  sidebarBackgroundColor String? @default("#f5f5f5")
  sidebarSelectedColor String? @default("#e5e5e5")
  sidebarHoverColor String? @default("#e5e5e580")
  cardInfoBackgroundColor String? @default("#fafafa")
  headerBackgroundColor String? @default("#ffffff")
  headerTextColor String? @default("#171717")
  headerBorderColor String? @default("#e5e5e5")
  searchBarBackgroundColor String? @default("#ffffff")
  searchBarBorderColor String? @default("#d4d4d4")
  searchBarTextColor String? @default("#171717")
  searchBarPlaceholderColor String? @default("#a3a3a3")
  searchBarIconColor String? @default("#a3a3a3")
  sidebarTextColor String? @default("#525252")
  sidebarSelectedTextColor String? @default("#171717")
  sidebarHeadingColor String? @default("#737373")
  sidebarDividerColor String? @default("#e5e5e5")
  sidebarBorderColor String? @default("#e5e5e5")
  productCardBorderColor String? @default("#e5e5e5")
  productCardHoverBorderColor String? @default("#d4d4d4")
  productCardTextColor String? @default("#171717")
  productCardCategoryTextColor String? @default("#737373")
  productCardPriceTextColor String? @default("#171717")
  buttonPrimaryBackgroundColor String? @default("#171717")
  buttonPrimaryTextColor String? @default("#ffffff")
  buttonSecondaryBackgroundColor String? @default("#ffffff")
  buttonSecondaryTextColor String? @default("#171717")
  buttonSecondaryBorderColor String? @default("#171717")
  linkColor String? @default("#525252")
  linkHoverColor String? @default("#171717")
  footerBackgroundColor String? @default("#ffffff")
  footerTextColor String? @default("#171717")
  footerHeadingColor String? @default("#171717")
  footerLinkColor String? @default("#525252")
  categorySectionTitleColor String? @default("#171717")
  categorySectionAccentColor String? @default("#171717")
  categorySectionLinkColor String? @default("#525252")
  categorySectionLinkHoverColor String? @default("#171717")
  categorySectionBorderColor String? @default("#e5e5e5")
  breadcrumbTextColor String? @default("#525252")
  breadcrumbActiveTextColor String? @default("#171717")
  breadcrumbHoverColor String? @default("#171717")
  breadcrumbIconColor String? @default("#a3a3a3")
  productDetailCardBackgroundColor String? @default("#ffffff")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  tenant         Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("store_settings")
}

enum UserRole {
  PLATFORM_ADMIN
  STORE_OWNER
}

enum OrderStatus {
  PENDING
  CONFIRMED
  SHIPPED
  DELIVERED
  CANCELLED
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum PaymentType {
  SETUP_FEE
  MONTHLY_SUBSCRIPTION
}

enum SubscriptionStatus {
  ACTIVE
  CANCELLED
  EXPIRED
  TRIAL
}

enum VerificationCodeType {
  EMAIL_CONFIRMATION
  PASSWORD_RESET
}

model VerificationCode {
  id        String               @id @default(uuid())
  userId    String
  code      String
  type      VerificationCodeType
  expiresAt DateTime
  used      Boolean              @default(false)
  createdAt DateTime             @default(now())
  user      User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, type])
  @@index([code, type, used])
  @@map("verification_codes")
}

model Payment {
  id            String        @id @default(uuid())
  userId        String
  tenantId      String
  type          PaymentType
  amount        Float
  status        PaymentStatus @default(PENDING)
  paymentMethod String?
  transactionId String?
  metadata      Json?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  user          User          @relation(fields: [userId], references: [id])
  tenant        Tenant        @relation(fields: [tenantId], references: [id])

  @@index([userId])
  @@index([tenantId])
  @@index([status])
  @@map("payments")
}

model Subscription {
  id                String            @id @default(uuid())
  tenantId           String            @unique
  status             SubscriptionStatus @default(ACTIVE)
  currentPeriodStart DateTime
  currentPeriodEnd   DateTime
  nextBillingDate    DateTime
  cancelledAt        DateTime?
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  tenant             Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@map("subscriptions")
}
